-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.classes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  name text NOT NULL,
  CONSTRAINT classes_pkey PRIMARY KEY (id)
);
CREATE TABLE public.sections (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  class_id uuid NOT NULL,
  name text NOT NULL,
  CONSTRAINT sections_pkey PRIMARY KEY (id),
  CONSTRAINT sections_class_id_fkey FOREIGN KEY (class_id) REFERENCES public.classes(id)
);
CREATE TABLE public.subjects (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  name text NOT NULL,
  CONSTRAINT subjects_pkey PRIMARY KEY (id)
);
CREATE TABLE public.teachers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  name text NOT NULL,
  subject_id uuid NOT NULL,
  CONSTRAINT teachers_pkey PRIMARY KEY (id),
  CONSTRAINT teachers_subject_id_fkey FOREIGN KEY (subject_id) REFERENCES public.subjects(id)
);
CREATE TABLE public.timeslots (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  start_time text NOT NULL,
  end_time text NOT NULL,
  is_lunch boolean DEFAULT false,
  CONSTRAINT timeslots_pkey PRIMARY KEY (id)
);
CREATE TABLE public.timetable_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  timetable_id uuid NOT NULL UNIQUE,
  user_id uuid NOT NULL,
  enabled_days ARRAY NOT NULL DEFAULT ARRAY[1, 2, 3, 4, 5],
  max_lunch_slots integer NOT NULL DEFAULT 1,
  lunch_slot_ids ARRAY NOT NULL DEFAULT ARRAY[]::text[],
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT timetable_settings_pkey PRIMARY KEY (id),
  CONSTRAINT timetable_settings_timetable_id_fkey FOREIGN KEY (timetable_id) REFERENCES public.timetables(id),
  CONSTRAINT timetable_settings_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.timetableentries (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  class_id uuid NOT NULL,
  section_id uuid NOT NULL,
  teacher_id uuid,
  subject_id uuid,
  time_slot_id uuid NOT NULL,
  day_id integer NOT NULL,
  timetable_id uuid,
  CONSTRAINT timetableentries_pkey PRIMARY KEY (id),
  CONSTRAINT timetableentries_class_id_fkey FOREIGN KEY (class_id) REFERENCES public.classes(id),
  CONSTRAINT timetableentries_section_id_fkey FOREIGN KEY (section_id) REFERENCES public.sections(id),
  CONSTRAINT timetableentries_subject_id_fkey FOREIGN KEY (subject_id) REFERENCES public.subjects(id),
  CONSTRAINT timetableentries_teacher_id_fkey FOREIGN KEY (teacher_id) REFERENCES public.teachers(id),
  CONSTRAINT timetableentries_time_slot_id_fkey FOREIGN KEY (time_slot_id) REFERENCES public.timeslots(id),
  CONSTRAINT timetableentries_timetable_id_fkey FOREIGN KEY (timetable_id) REFERENCES public.timetables(id)
);
CREATE TABLE public.timetables (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  name text NOT NULL DEFAULT 'Untitled Timetable'::text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT timetables_pkey PRIMARY KEY (id),
  CONSTRAINT timetables_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);